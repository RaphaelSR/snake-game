rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /rankings/{document} {
      allow read: if true;
      allow write: if isValidRanking(request.resource.data);
    }
    
    function isValidRanking(data) {
      return data.keys().hasAll(['playerName', 'score', 'mode', 'difficulty', 'timestamp']) &&
             data.playerName is string &&
             data.playerName.size() >= 2 &&
             data.playerName.size() <= 20 &&
             data.score is number &&
             data.score >= 10 &&
             data.score <= 100000 &&
             data.mode in ['classic', 'infinite', 'moving_food', 'time_attack'] &&
             data.difficulty in ['easy', 'regular', 'hard'];
    }
  }
}
